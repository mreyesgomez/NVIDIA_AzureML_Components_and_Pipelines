$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
name: tao_bpnet_prune
display_name: tao_bpnet_prune
description: Wrapper for TAO command bpnet prune. Pruning removes parameters from the model to reduce the model size without compromising the integrity of the model itself <a href=https://github.com/mreyesgomez/NVIDIA_AzureML_Components_and_Pipelines/tree/main/components/tao/tfv3.22.05-tf1.15.4/object_detection/detectnet_v2/tao_detectnet_v2_prune/README.md>Reference file</a>
version: 1
type: command
inputs:
  model_app_name:
    type: string
    default: bpnet
  unpruned_model_dir:
    type: uri_folder
  unpruned_model_subfolder:
    type: string
    default: experiment_dir_unpruned/weights
  unpruned_model_name:
    type: string
    default: model.tlt
  pruned_model_subfolder:
    type: string
    default: experiment_dir_pruned
  pruned_model_name:
    type: string
    default: bpnet_model.pruned-0.2.tlt
  key:
    type: string
    default: 'nvidia_tlt'
  equalization_criterion:
    type: string
    default: ND
  pth:
    type: string
    default: ND
  normalizer:
    type: string
    default: ND
  excluded_layers:
    type: string
    default: ND
  pruning_granularity:
    type: string
    default: ND
  min_num_filters:
    type: string
    default: ND
outputs:
  pruned_model_dir:
    type: uri_folder
code: ./
environment: azureml://registries/tme-bodypose-demo/environments/tao-toolkit-4.0.0-tf1.15.5/versions/2
command: >-
  bash ./tao_detectnet_v2_prune.sh 
  ${{inputs.unpruned_model_dir}}/${{inputs.model_app_name}}/
  ${{inputs.unpruned_model_subfolder}}
  ${{inputs.unpruned_model_name}} 
  ${{inputs.pruned_model_subfolder}} 
  ${{inputs.pruned_model_name}} 
  ${{inputs.key}} 
  ${{outputs.pruned_model_dir}}/${{inputs.model_app_name}}
  ${{inputs.equalization_criterion}} 
  ${{inputs.pth}} 
  ${{inputs.normalizer}} 
  ${{inputs.excluded_layers}} 
  ${{inputs.pruning_granularity}} 
  ${{inputs.min_num_filters}}

